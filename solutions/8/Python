x,_,*l=open(0)
import math
for k in['AAA'],l:print(math.lcm(*[len([c:={l[:3]:l for l in l}[c[:3]][(v>"L")*5+7:]for v in 99*x[:-1]if'Z'>c[2]])for C in k if(c:=C)[2]<"B"]))