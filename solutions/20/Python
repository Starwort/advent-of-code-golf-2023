d={a[0][1:]:[k[0],a[2:],0]for k in sorted(open(0))if'rx'!=(a:=k.replace(*', ').split())[2]or(P:=a[0][1:])}
l=h=i=0
t=1
while q:=[(n,0)for n in a[1:]]:
 z=i<1e3
 for n,v in q:
  l+=z>v;h+=z*v
  if(k:=d.get(n))and'%'!=v*k[0]:t*=i*(P in k[1]*k[2])+1;t>1e11>print(l*h,t);k[2]=1-(all(V for _,N,V in d.values()if a!=n in N),k[2])[k[0]<'&'];q+=[(o,k[2])for o in k[1]]
 i+=1