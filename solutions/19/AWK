func M(a,r,i,e){if($0=W[a]){if(NF>r+=2){e=$r;(l=+$++r--)||p=--$++r;n=$(r+1)
i[e]=$0=z[e];b=$2;if(l?$1>l&&z[e]=$1s ($1=l>b?l:b):b<p&&z[e]=($2=p<$1?p:$1)s b)
z[e]=$0M(n);M(a,r)}M($NF)}p=a~/A/;for(e in z){$0=z[e];p*=$2-$1}B+=p;for(e in i)
z[e]=i[e]}B=gsub(/[{:,>=}]/,y=s=FS){W[$1]=gsub(/</,s"&"s)$0}+$NF{for(++B;B-=2;)
y+=z[$(B-1)]=$B--s$B;A+=M(I="in")B*y}END{for(B in z)z[B]=4e3;M(I);print A"\n"B}